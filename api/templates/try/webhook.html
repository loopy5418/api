<!DOCTYPE html>
<html lang="en" class="transition-colors">
<head>
  <meta charset="UTF-8">
  <title>Webhook Sender - API Playground</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body, .bg-main {
      background: #181c20 !important;
    }
    .rounded-xl, .rounded, .embed-block, .author-section, .footer-section, .image-section, .thumbnail-section, .fields-list {
      background: #23272e !important;
    }
    .text-main {
      color: #e5e7eb !important;
    }
    .input-main, .embed-title, .embed-description, .embed-url, .embed-color,
    .author-name, .author-url, .author-icon_url,
    .footer-text, .footer-icon_url,
    .image-url, .thumbnail-url,
    .field-name, .field-value {
      background: #23272e !important;
      color: #e5e7eb !important;
      border: 1px solid #2d323a;
    }
    .input-main:focus, .embed-title:focus, .embed-description:focus, .embed-url:focus, .embed-color:focus,
    .author-name:focus, .author-url:focus, .author-icon_url:focus,
    .footer-text:focus, .footer-icon_url:focus,
    .image-url:focus, .thumbnail-url:focus,
    .field-name:focus, .field-value:focus {
      outline: 2px solid #3b82f6;
      background: #23272e;
    }
    .shadow-md, .shadow, .shadow-lg {
      box-shadow: none !important;
    }
    .bg-blue-700 { background: #2563eb !important; }
    .bg-blue-800 { background: #1e40af !important; }
    .bg-green-600 { background: #059669 !important; }
    .bg-green-700 { background: #047857 !important; }
    .bg-yellow-500 { background: #eab308 !important; }
    .bg-yellow-600 { background: #ca8a04 !important; }
    .bg-gray-600 { background: #374151 !important; }
    .bg-gray-700 { background: #23272e !important; }
    .bg-gray-800 { background: #181c20 !important; }
    .bg-gray-900 { background: #181c20 !important; }
    .text-white { color: #f3f4f6 !important; }
    .text-gray-700, .text-gray-900, .text-gray-200, .text-gray-300 { color: #e5e7eb !important; }
    .text-green-200 { color: #bbf7d0 !important; }
    .text-green-400 { color: #4ade80 !important; }
    .text-red-400 { color: #f87171 !important; }
    .text-yellow-400 { color: #facc15 !important; }
    .border-t, .dark\:border-gray-700 { border-top: 1px solid #23272e !important; }
    .cursor-pointer { cursor: pointer; }
    .transition { transition: background 0.2s, color 0.2s; }
    .overflow-x-auto { overflow-x: auto; }
    .hidden { display: none; }
    .font-semibold { font-weight: 600; }
    .font-bold { font-weight: 700; }
    .rounded { border-radius: 0.5rem; }
    .rounded-xl { border-radius: 1rem; }
    .p-4 { padding: 1rem; }
    .p-2 { padding: 0.5rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mt-2 { margin-top: 0.5rem; }
    .mt-4 { margin-top: 1rem; }
    .max-w-xs { max-width: 20rem; }
    .max-h-xs { max-height: 20rem; }
    .w-full { width: 100%; }
    .w-1\/3 { width: 33.333333%; }
    .w-2\/3 { width: 66.666667%; }
    .ml-2 { margin-left: 0.5rem; }
    .ml-0 { margin-left: 0; }
    .space-x-4 > :not([hidden]) ~ :not([hidden]) { margin-left: 1rem; }
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .flex-row { flex-direction: row; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .gap-2 { gap: 0.5rem; }
    .gap-8 { gap: 2rem; }
    .mx-auto { margin-left: auto; margin-right: auto; }
    .max-w-6xl { max-width: 72rem; }
    .min-h-screen { min-height: 100vh; }
    .overflow-x-auto { overflow-x: auto; }
    .resize-y { resize: vertical; }
    .border-light {
        border: 1.5px solid #474a51 !important;
    }
    .border-light-inner {
        border: 1px solid #474a51 !important;
    }
    .rounded-lg {
        border-radius: 0.75rem !important;
    }
    .rounded-xl {
        border-radius: 1rem !important;
    }
  </style>
  <script>
    // (JS code unchanged)
    // Helper to update preview
    function updatePreview() {
      const content = document.getElementById('content').value;
      const username = document.getElementById('username').value;
      const avatar_url = document.getElementById('avatar_url').value;
      const embeds = [];
      document.querySelectorAll('.embed-block').forEach(embedBlock => {
        const embed = {};
        // Simple fields
        embed.title = embedBlock.querySelector('.embed-title').value;
        embed.description = embedBlock.querySelector('.embed-description').value;
        embed.url = embedBlock.querySelector('.embed-url').value;
        embed.color = embedBlock.querySelector('.embed-color').value ? parseInt(embedBlock.querySelector('.embed-color').value) : undefined;

        // Author
        if (embedBlock.querySelector('.toggle-author').checked) {
          const author = {};
          author.name = embedBlock.querySelector('.author-name').value;
          author.url = embedBlock.querySelector('.author-url').value;
          author.icon_url = embedBlock.querySelector('.author-icon_url').value;
          // Only include if at least one field is filled
          if (author.name || author.url || author.icon_url) embed.author = author;
        }

        // Footer
        if (embedBlock.querySelector('.toggle-footer').checked) {
          const footer = {};
          footer.text = embedBlock.querySelector('.footer-text').value;
          footer.icon_url = embedBlock.querySelector('.footer-icon_url').value;
          if (footer.text || footer.icon_url) embed.footer = footer;
        }

        // Image
        if (embedBlock.querySelector('.toggle-image').checked) {
          const image_url = embedBlock.querySelector('.image-url').value;
          if (image_url) embed.image = { url: image_url };
        }

        // Thumbnail
        if (embedBlock.querySelector('.toggle-thumbnail').checked) {
          const thumb_url = embedBlock.querySelector('.thumbnail-url').value;
          if (thumb_url) embed.thumbnail = { url: thumb_url };
        }

        // Fields
        const fields = [];
        embedBlock.querySelectorAll('.embed-field').forEach(fieldBlock => {
          const name = fieldBlock.querySelector('.field-name').value;
          const value = fieldBlock.querySelector('.field-value').value;
          const inline = fieldBlock.querySelector('.field-inline').checked;
          if (name && value) fields.push({ name, value, inline });
        });
        if (fields.length) embed.fields = fields;

        // Remove empty string fields and undefined
        Object.keys(embed).forEach(k => {
          if (embed[k] === "" || embed[k] === undefined) delete embed[k];
        });

        // Only push if at least one property
        if (Object.keys(embed).length) embeds.push(embed);
      });
      document.getElementById('preview').textContent = JSON.stringify({
        content, username, avatar_url, embeds
      }, null, 2);
    }

    function addEmbed() {
    const embedList = document.getElementById('embeds');
    const embedIdx = embedList.children.length;
    const embedBlock = document.createElement('div');
    embedBlock.className = "embed-block p-4 mb-4 border-light rounded-xl";
    embedBlock.innerHTML = `
      <div class="flex justify-between items-center mb-2">
        <span class="font-bold text-main">Embed #${embedIdx + 1}</span>
        <button type="button" class="text-red-400 hover:text-red-600" onclick="this.closest('.embed-block').remove(); updatePreview();">Remove</button>
      </div>
      <input class="embed-title input-main block w-full mb-2 p-2 rounded-lg" placeholder="Title (optional)" oninput="updatePreview()">
      <textarea class="embed-description input-main block w-full mb-2 p-2 rounded-lg" placeholder="Description (optional)" oninput="updatePreview()"></textarea>
      <input class="embed-url input-main block w-full mb-2 p-2 rounded-lg" placeholder="URL (optional)" oninput="updatePreview()">
      <input class="embed-color input-main block w-full mb-2 p-2 rounded-lg" placeholder="Color (int, optional)" type="number" oninput="updatePreview()">

      <div class="flex items-center mb-2">
        <input type="checkbox" class="toggle-author mr-2" id="toggle-author-${embedIdx}" onchange="this.parentElement.nextElementSibling.classList.toggle('hidden', !this.checked); updatePreview();">
        <label for="toggle-author-${embedIdx}" class="text-main cursor-pointer">Author</label>
      </div>
      <div class="author-section hidden mb-2 p-3 border-light-inner rounded-lg">
        <input class="author-name input-main block w-full mb-1 p-2 rounded-lg" placeholder="Author Name (optional)" oninput="updatePreview()">
        <input class="author-url input-main block w-full mb-1 p-2 rounded-lg" placeholder="Author URL (optional)" oninput="updatePreview()">
        <input class="author-icon_url input-main block w-full mb-1 p-2 rounded-lg" placeholder="Author Icon URL (optional)" oninput="updatePreview()">
      </div>

      <div class="flex items-center mb-2">
        <input type="checkbox" class="toggle-footer mr-2" id="toggle-footer-${embedIdx}" onchange="this.parentElement.nextElementSibling.classList.toggle('hidden', !this.checked); updatePreview();">
        <label for="toggle-footer-${embedIdx}" class="text-main cursor-pointer">Footer</label>
      </div>
      <div class="footer-section hidden mb-2 p-3 border-light-inner rounded-lg">
        <input class="footer-text input-main block w-full mb-1 p-2 rounded-lg" placeholder="Footer Text (optional)" oninput="updatePreview()">
        <input class="footer-icon_url input-main block w-full mb-1 p-2 rounded-lg" placeholder="Footer Icon URL (optional)" oninput="updatePreview()">
      </div>

      <div class="flex items-center mb-2">
        <input type="checkbox" class="toggle-image mr-2" id="toggle-image-${embedIdx}" onchange="this.parentElement.nextElementSibling.classList.toggle('hidden', !this.checked); updatePreview();">
        <label for="toggle-image-${embedIdx}" class="text-main cursor-pointer">Image</label>
      </div>
      <div class="image-section hidden mb-2 p-3 border-light-inner rounded-lg">
        <input class="image-url input-main block w-full mb-1 p-2 rounded-lg" placeholder="Image URL (optional)" oninput="updatePreview()">
      </div>

      <div class="flex items-center mb-2">
        <input type="checkbox" class="toggle-thumbnail mr-2" id="toggle-thumbnail-${embedIdx}" onchange="this.parentElement.nextElementSibling.classList.toggle('hidden', !this.checked); updatePreview();">
        <label for="toggle-thumbnail-${embedIdx}" class="text-main cursor-pointer">Thumbnail</label>
      </div>
      <div class="thumbnail-section hidden mb-2 p-3 border-light-inner rounded-lg">
        <input class="thumbnail-url input-main block w-full mb-1 p-2 rounded-lg" placeholder="Thumbnail URL (optional)" oninput="updatePreview()">
      </div>

      <div class="fields-list"></div>
      <button type="button" class="mt-2 bg-blue-700 hover:bg-blue-800 text-white px-3 py-1 rounded-lg" onclick="addField(this);">Add Field</button>
    `;
    embedList.appendChild(embedBlock);
    updatePreview();
  }

  function addField(btn) {
    const fieldsList = btn.parentElement.querySelector('.fields-list');
    const fieldBlock = document.createElement('div');
    fieldBlock.className = "embed-field flex space-x-2 mb-2 p-2 border-light-inner rounded-lg";
    fieldBlock.innerHTML = `
      <input class="field-name input-main w-1/3 p-1 rounded-lg" placeholder="Field Name" oninput="updatePreview()">
      <input class="field-value input-main w-2/3 p-1 rounded-lg" placeholder="Field Value" oninput="updatePreview()">
      <label class="flex items-center text-xs text-main ml-2">
        <input type="checkbox" class="field-inline mr-1">Inline
      </label>
      <button type="button" class="text-red-400 hover:text-red-600 ml-2" onclick="this.parentElement.remove(); updatePreview();">✕</button>
    `;
    fieldsList.appendChild(fieldBlock);
    updatePreview();
  }
    async function sendWebhook() {
      updatePreview();
      const content = document.getElementById('content').value;
      const username = document.getElementById('username').value;
      const avatar_url = document.getElementById('avatar_url').value;
      const url = document.getElementById('webhook_url').value;
      const embeds = [];
      document.querySelectorAll('.embed-block').forEach(embedBlock => {
        const embed = {};
        embed.title = embedBlock.querySelector('.embed-title').value;
        embed.description = embedBlock.querySelector('.embed-description').value;
        embed.url = embedBlock.querySelector('.embed-url').value;
        embed.color = embedBlock.querySelector('.embed-color').value ? parseInt(embedBlock.querySelector('.embed-color').value) : undefined;

        // Author
        if (embedBlock.querySelector('.toggle-author').checked) {
          const author = {};
          author.name = embedBlock.querySelector('.author-name').value;
          author.url = embedBlock.querySelector('.author-url').value;
          author.icon_url = embedBlock.querySelector('.author-icon_url').value;
          if (author.name || author.url || author.icon_url) embed.author = author;
        }

        // Footer
        if (embedBlock.querySelector('.toggle-footer').checked) {
          const footer = {};
          footer.text = embedBlock.querySelector('.footer-text').value;
          footer.icon_url = embedBlock.querySelector('.footer-icon_url').value;
          if (footer.text || footer.icon_url) embed.footer = footer;
        }

        // Image
        if (embedBlock.querySelector('.toggle-image').checked) {
          const image_url = embedBlock.querySelector('.image-url').value;
          if (image_url) embed.image = { url: image_url };
        }

        // Thumbnail
        if (embedBlock.querySelector('.toggle-thumbnail').checked) {
          const thumb_url = embedBlock.querySelector('.thumbnail-url').value;
          if (thumb_url) embed.thumbnail = { url: thumb_url };
        }

        // Fields
        const fields = [];
        embedBlock.querySelectorAll('.embed-field').forEach(fieldBlock => {
          const name = fieldBlock.querySelector('.field-name').value;
          const value = fieldBlock.querySelector('.field-value').value;
          const inline = fieldBlock.querySelector('.field-inline').checked;
          if (name && value) fields.push({ name, value, inline });
        });
        if (fields.length) embed.fields = fields;

        // Remove empty string fields and undefined
        Object.keys(embed).forEach(k => {
          if (embed[k] === "" || embed[k] === undefined) delete embed[k];
        });

        if (Object.keys(embed).length) embeds.push(embed);
      });

      const payload = {
  url,
  content,
  username,
  avatar_url
};

const cleanedEmbeds = embeds.filter(e => Object.keys(e).length);
if (cleanedEmbeds.length) {
  payload.embeds = cleanedEmbeds;
}

      document.getElementById('send-status').textContent = '';
      try {
        const resp = await fetch('https://api.loopy5418.dev/webhook-send', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const data = await resp.json();
        if (data.success) {
          document.getElementById('send-status').textContent = '✅ Webhook sent!';
          document.getElementById('send-status').className = 'text-green-400 mt-2';
        } else {
          document.getElementById('send-status').textContent = '❌ ' + (data.error || 'Failed to send webhook.');
          document.getElementById('send-status').className = 'text-red-400 mt-2';
        }
      } catch (e) {
        document.getElementById('send-status').textContent = '❌ Network error.';
        document.getElementById('send-status').className = 'text-red-400 mt-2';
      }
    }
  </script>
</head>
<body class="bg-main text-main min-h-screen">
  <!-- Header with title and buttons -->
  <header class="flex flex-col md:flex-row items-center justify-between py-6 px-8 shadow bg-main">
    <div class="flex items-center space-x-4">
      <span class="text-2xl font-bold tracking-tight">Loopy API Playground</span>
      <span class="text-xs bg-gray-700 text-gray-300 px-2 py-1 rounded">v1</span>
    </div>
    <div class="mt-4 md:mt-0 ml-0 md:ml-6">
      <a href="/" class="bg-yellow-500 hover:bg-yellow-600 text-black px-3 py-2 rounded transition" title="Return to index">← Return to Index</a>
    </div>
  </header>
  <!-- Main Content -->
<main class="max-w-6xl mx-auto flex flex-col md:flex-row gap-4 px-4">
    <section class="md:w-1/2 rounded-xl p-6">
      <h2 class="text-xl font-semibold mb-4">Send a Discord Webhook</h2>
      <div class="mb-3">
        <input id="webhook_url" class="input-main block w-full mb-2 p-2 rounded" placeholder="Webhook URL (required)" oninput="updatePreview()">
        <input id="username" class="input-main block w-full mb-2 p-2 rounded" placeholder="Username (optional)" oninput="updatePreview()">
        <input id="avatar_url" class="input-main block w-full mb-2 p-2 rounded" placeholder="Avatar URL (optional)" oninput="updatePreview()">
        <textarea id="content" class="input-main block w-full mb-2 p-2 rounded" placeholder="Content (optional)" rows="2" oninput="updatePreview()"></textarea>
      </div>
      <div>
        <div class="flex items-center justify-between mb-2">
          <span class="font-semibold text-main">Embeds</span>
          <button type="button" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded" onclick="addEmbed()">Add Embed</button>
        </div>
        <div id="embeds"></div>
      </div>
      <button class="mt-4 bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded" onclick="sendWebhook()">Send</button>
      <div id="send-status" class="mt-2"></div>
    </section>
    <!-- Right: Preview -->
    <section class="md:w-1/2 rounded-xl p-6 flex flex-col h-full" style="background:#23272e;">
        <h2 class="text-xl font-semibold mb-4 text-main">Preview</h2>
      <pre id="preview" class="bg-gray-800 text-green-200 rounded p-4 text-sm overflow-x-auto w-full">{}</pre>
    </section>
  </main>
  <script>
    // Initialize with one embed for user convenience
    window.onload = function() {
      addEmbed();
      updatePreview();
    };
  </script>
</body>
</html>